!function(t){var e={};function n(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(s,r,function(e){return t[e]}.bind(null,r));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function s(t,e="Failed assert"){if(!t)throw new Error(e)}n.r(e);const r=["","M=","D=","MD=","A=","AM=","AD=","AMD="],i=["",";JGT",";JEQ",";JGE",";JLT",";JNE",";JLE",";JMP"],o=Symbol(),c=["D&A","!(D&A)","D+A",o,"D&!A","!(D&!A)",o,"A-D",o,o,o,o,"D","!D","D-1","~D","!D&A","D|!A",o,"D-A","!D&!A","D|A",o,o,o,o,o,o,o,o,o,"D+1",o,o,o,o,o,o,o,o,o,o,"0",o,o,o,o,o,"A","!A","A-1","~A",o,o,o,"A+1",o,o,"-1",o,o,o,o,"1","D&M","!(D&M)","D+M",o,"D&!M","!D|M",o,"M-D",o,o,o,o,o,o,o,o,"!D&M","D|!M",o,"D-M","!D&!M","D|M",o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,o,"M","!M","M-1","~M",o,o,o,"M+1",o,o,o,o,o,o,o,o].map((t,e)=>t===o?`X${e.toString(16).toUpperCase()}`:t);function a(t){if(s(/^[01]{16}$/.test(t),`Instruction '${t}' does not match format.`),"0"===t[0])return e=parseInt(t,2),{type:"a",eval:t=>{t.a=e,t.pc++},emit:()=>`@${e}`};var e;return function(t,e,n){return{type:"c",eval:s=>{let r=s.d,i=64&t?s.m:s.a;32&t&&(r=0),16&t&&(r=65535&~r),8&t&&(i=0),4&t&&(i=65535&~i);let o=2&t?r+i&65535:r&i;1&t&&(o=65535&~o),1&e&&(s.m=o),2&e&&(s.d=o),4&e&&(s.a=o);const c=32768&o,a=0===o;n&((c?4:0)|(a?2:0)|(c||a?0:1))?s.pc=s.a:s.pc++},emit:()=>`${r[e]}${c[t]}${i[n]}`}}(parseInt(t.substr(3,7),2),parseInt(t.substr(10,3),2),parseInt(t.substr(13,3),2))}class l{constructor(){this._pc=0,this.a=0,this.d=0,this.ram=Array.from({length:32768}).fill(0)}get m(){return s(this.a<=32767,"Accessed memory OOB, a="+this.a),this.ram[this.a]}set m(t){s(this.a<=32767,"Accessed memory OOB, a="+this.a),this.ram[this.a]=t}get pc(){return this._pc}set pc(t){s(t<32767,"PC out of bounds, tried to set "+t),this._pc=t}}class u{constructor(t){this._ticks=0,this.cpu=new l,this.histogram=Array.from({length:32768}).fill(0);const e=t.slice();for(;e.length<32768;)e.push(a("0000000000000000"));this.rom=e}get ram(){return this.cpu.ram}get ticks(){return this._ticks}step(){this._ticks++,this.histogram[this.cpu.pc]++,this.rom[this.cpu.pc].eval(this.cpu)}toString(){return`Machine { a = ${this.cpu.a}, d = ${this.cpu.d}, m = ${this.cpu.m}, pc = ${this.cpu.pc}}`}}console.log("Inspect the window.machine global after loading a hack file.");const p=t=>document.querySelector(t);function d(t){let e="";return 32768&t&&(t=1+(32767&~t),e="-"),e+t.toString()}const m=p("#load-hack"),f=p("#action-step"),h=p("#action-step-x"),v=p("#input-step-x"),g=p("#d-value"),w=p("#a-value"),D=p("#m-value"),b=p("#pc-value"),M=p("#input-step-rate"),y=p("#playing-label");y.textContent="▶";const A=p("canvas"),$=A.getContext("2d");let x;function E(){clearTimeout(x),x=void 0,M.disabled=f.disabled=h.disabled=v.disabled=!1,y.textContent="▶"}p("#action-reset").addEventListener("click",()=>{E(),z(window.fileText)},{passive:!0}),p("#action-step-rate").addEventListener("click",()=>{x?E():function(){M.disabled=f.disabled=h.disabled=v.disabled=!0,y.textContent="❙❙";const t=+M.value/1e3;x=setTimeout((function e(){S(1),x=setTimeout(e,t)}),t)}()},{passive:!0}),f.addEventListener("click",()=>S(1),{passive:!0}),h.addEventListener("click",()=>S(+v.value),{passive:!0});const T=new Clusterize({rows:[],scrollElem:p("#rom .clusterize-scroll"),contentElem:p("#rom .clusterize-content")}),k=new Clusterize({rows:[],scrollElem:p("#ram .clusterize-scroll"),contentElem:p("#ram .clusterize-content")}),C=new Clusterize({rows:[],scrollElem:p("#stack .clusterize-scroll"),contentElem:p("#stack .clusterize-content")});function z(t){var e;try{!function(t){E(),window.machine=new u(t),S(0),$&&($.fillStyle="white",$.fillRect(0,0,A.width,A.height))}(null!==(e=null==t?void 0:t.split("\n").map(t=>t.trim()).filter(Boolean).map(a))&&void 0!==e?e:[])}catch(t){alert(t.message)}}function S(t){const e=window.machine;if(e){try{for(let n=0;n<t;n++)if(e.step(),e.cpu.a>=16384&&$){const t=Math.floor((e.cpu.a-16384)/32),n=e.cpu.a-16384-32*t,s=e.cpu.m;for(let e=0;e<16;e++)$.fillStyle=s&1<<e?"black":"white",$.fillRect(n+e,t,1,1)}}catch(t){alert(t.message)}!function(){const t=window.machine;t&&(g.textContent=d(t.cpu.d),w.textContent=d(t.cpu.a),D.textContent=d(t.cpu.m),b.textContent=d(t.cpu.pc))}(),T.update(e.rom.map((t,n)=>n===e.cpu.pc?`<div class="row hl"><strong>${n}</strong><span>${t.emit()}</span></div>`:`<div class="row"><strong>${n}</strong><span>${t.emit()}</span></div>`)),n(p("#rom .clusterize-scroll"),24*e.cpu.pc),k.update(e.ram.map((t,n)=>n===e.cpu.a?`<div class="row hl"><strong>${n}</strong><span>${d(t)}</span></div>`:`<div class="row"><strong>${n}</strong><span>${d(t)}</span></div>`)),n(p("#ram .clusterize-scroll"),24*e.cpu.a),C.update(e.ram.slice(256,e.ram[0]+5).map((t,n)=>n+256===e.ram[0]?`<div class="row hl"><strong>${n+256}</strong><span>${d(t)}</span></div>`:`<div class="row"><strong>${n+256}</strong><span>${d(t)}</span></div>`)),n(p("#stack .clusterize-scroll"),24*(e.ram[0]-256))}function n(t,e){t.scrollTop+t.clientHeight<e?t.scrollTop=e-Math.floor(2*t.clientHeight/3):e<t.scrollTop&&(t.scrollTop=e-Math.floor(1*t.clientHeight/3))}}m.addEventListener("change",()=>{m.files&&m.files[0]&&function(t){const e=new FileReader;e.addEventListener("load",()=>{window.fileText=e.result,z(window.fileText)},{passive:!0}),e.readAsText(t)}(m.files[0])},{passive:!0})}]);